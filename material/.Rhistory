x = random(0,1,100)
x = rnorm(100)
x
y = sin(x)
y
plot(x,y)
lm(y~x)
lm(y~x+b)
lm(y~x)
model <- lm(y~x)
model$residuals
summary(model)
plot(x,y)+plot(model)
qqnorm(y)
qqnorm(x)
qqnorm(model)
qqnorm(x)
qqnorm(y)
qqplot(x,y)
qqplot(y,x)
asin(y)
z <- asin(y)
plot(x,z)
citation()
citation("rgdal")
citation("RSToolbox")
citation("RStoolbox")
setwd("~/Documents/curso-sopi-herramientas-cuantitativas/material/imagenes")
?rasterImage
library(raster)
l8 <- brick("l1_l8_oli_20130819.tif")
l8
names(l8)
names(l8) <- c(482,561,654,864,1608,2200)
names(l8)
names(l8) <- c("482","561","654","864","1608","2200")
names(l8)
plotRGB(l8)
plotRGB(l8, stretch='lin')
install.packages(c("landsat", "landsat8"))
library(landsat)
?landsat
library(RStoolbox)
b3 <- as.data.frame(l8$X654)
b4 <- as.data.frame(l8$X864)
bsl_test <- BSL(b3,b4)
bsl_test <- BSL(b3,b4, method="minimun")
bsl_test <- BSL(b3,b4, method="quantile", ulimit=0.99, llimit=0.005)
b3
bsl_test <- BSL(b3$X654,b4$X864, method="quantile", ulimit=0.99, llimit=0.005)
data(nov3)
nov3
data(nov4)
data(nov3)
data(nov4)
nov.bsl <- BSL(nov3, nov4)
plot(as.vector(as.matrix(nov3)), as.vector(as.matrix(nov4)))
abline(nov.bsl$BSL, col="red")
points(nov.bsl$top[1], nov.bsl$top[2], col="green", cex=2, pch=16)
as.data.frame(nov3)
nov.bsl
l8 <- brick("l1_l8_oli_20130819.tif", na.rm=TRUE)
names(l8) <- c("482","561","654","864","1608","2200")
l8
b3 <- as.data.frame(l8$X654)
b4 <- as.data.frame(l8$X864)
bsl(b3,b4)
BSL(b3,b4)
b3
b3 <- 255/10000*b3
b3
b3 <- int(255/10000*b3)
b3 <- integer(255/10000*b3)
b3 <- integer(b3)
b3
b4 <- 255/10000*b4
BSL(b3,b4)
data(nov3)
data(nov4)
nov.bsl <- BSL(b3, b4)
plot(as.vector(as.matrix(b3)), as.vector(as.matrix(b4)))
abline(nov.bsl$BSL, col="red")
points(nov.bsl$top[1], nov.bsl$top[2], col="green", cex=2, pch=16)
nov.bsl
nov.bsl <- BSL(b3, b4, method="quantile", ulimit=0.99, llimit=0.005)
nov.bsl
nov.bsl <- BSL(b3, b4, method="quantile", ulimit=0.99, llimit=0.02)
nov.bsl
(b3 > 0.1)
(b3 > 0.1)*b3
(b3 > 0.1 & b4 > 0.1)*b3
b3a<-(b3 > 25 & b4 > 25)*b3
b4a<-(b3 > 25 & b4 > 25)*b4
BSL(b3a,b4a)
> b3a<-(b3 > 100 & b4 > 100)*b3
> b4a<-(b3 > 100 & b4 > 100)*b4
> BSL(b3a,b4a)
b3a<-(b3 > 100 & b4 > 100)*b3
b4a<-(b3 > 100 & b4 > 100)*b4
BSL(b3a,b4a)
b3a
b3
b3<10
b3<10 ==true
BSL(b3,b4, method="minimun")
nov.bsl <- BSL(b3, b4, method="quantile", ulimit=0.95, llimit=0.005)
nov.bsl
b4
setwd("~/")
l8 <- brick("pepe.tif")
plotRGB(l8)
plotRGB(l8, stretch='lin')
l8
summary(l8)
l9 <- round(l8*255/10000, digits=0)
l9
BSL(l9$pepe.3, l9$pepe.4)
BSL(as.data.frame(l9$pepe.3), as.data.frame(l9$pepe.4))
a3<- as.data.frame(l9$pepe.3)
a4<- as.data.frame(l9$pepe.4)
data(nov3)
data(nov4)
nov.bsl <- BSL(a3, a4)
plot(as.vector(as.matrix(a3)), as.vector(as.matrix(a4)))
abline(nov.bsl$BSL, col="red")
points(nov.bsl$top[1], nov.bsl$top[2], col="green", cex=2, pch=16)
l8 <- brick("pepe2.tif")
l9 <- round(l8*255/10000, digits=0)
a3<- as.data.frame(l9$pepe.3)
a3<- as.data.frame(l9$pepe2.3)
a4<- as.data.frame(l9$pepe2.4)
data(nov3)
data(nov4)
nov.bsl <- BSL(a3, a4)
plot(as.vector(as.matrix(a3)), as.vector(as.matrix(a4)))
abline(nov.bsl$BSL, col="red")
points(nov.bsl$top[1], nov.bsl$top[2], col="green", cex=2, pch=16)
nov.bsl
nov.bsl <- BSL(a3, a4, method="quantile", ulimit = 0.99, llimit = 0.005)
BSL(a3, a4, method="quantile", ulimit = 0.99, llimit = 0.005)
BSL(a3, a4, method="quantile", ulimit = 0.99, llimit = 0.01)
BSL(a3, a4, method="quantile", ulimit = 0.80, llimit = 0.01)
BSL(a3, a4, method="quantile", ulimit = 0.50, llimit = 0.1)
library(raster)
library("landsat", lib.loc="~/R/x86_64-pc-linux-gnu-library/3.2")
library("landsat8", lib.loc="~/R/x86_64-pc-linux-gnu-library/3.2")
library("RStoolbox", lib.loc="~/R/x86_64-pc-linux-gnu-library/3.2")
l8 <- brick("Documents/curso-sopi-herramientas-cuantitativas/material/imagenes/l8_oli_20131107.tif")
l8 <- readOGR(dsn="./",layer = "pepe")
l8 <- brick("Documents/curso-sopi-herramientas-cuantitativas/material/imagenes/l8_oli_20131107.tif")
vec <- brick("Documents/curso-sopi-herramientas-cuantitativas/material/imagenes/l8_oli_20131107.tif")
vec <- readOGR(dsn="./",layer = "pepe")
plotRGB(l8, stretch="lin")
ggRGB(l8, stretch="lin")
ggRGB(l8, r=3, g=2, b=1, stretch="lin",maxpixels = 1e+5)
ggRGB(l8, r=3, g=2, b=1, maxpixels = 1e+5)
ggRGB(l8, r=3, g=2, b=1, maxpixels = 1e+5, geom_raster = TRUE)
library(ggplot2)
df_poly <- fortify(l8)
df_poly <- fortify(vec)
ggRGB(l8, r=3, g=2, b=1, maxpixels = 1e+5, geom_raster = TRUE)+geom_path(data=df_poly)
ggRGB(l8, r=3, g=2, b=1, maxpixels = 1e+5, geom_raster = TRUE)+geom_path(data=df_poly, aes(x=lat, y=long))
vec
vec <- readOGR(dsn="./",layer = "pepe2")
vec
df_poly <- fortify(vec)
ggRGB(l8, r=3, g=2, b=1, maxpixels = 1e+5, geom_raster = TRUE)+geom_path(data=df_poly, aes(x=lat, y=long))
ggRGB(l8, r=3, g=2, b=1, maxpixels = 1e+5, geom_raster = TRUE)
df_poly
ggRGB(l8, r=3, g=2, b=1, maxpixels = 1e+5, geom_raster = TRUE)+geom_path(data=df_poly, aes(x=long, y=lat, group=piece))
ggRGB(l8, r=3, g=2, b=1, maxpixels = 1e+5, geom_raster = TRUE)+geom_path(data=df_poly, aes(x=long, y=lat, group=id))
ggRGB(l8, r=3, g=2, b=1, maxpixels = 1e+5, geom_raster = TRUE)+geom_path(data=df_poly, aes(x=long, y=lat, group=id),col='red')
ggRGB(l8, r=3, g=2, b=1, maxpixels = 1e+5, geom_raster = TRUE)+geom_path(data=df_poly, aes(x=long, y=lat, group=id),col='red')+coord_equal()
l8[vec]
mean(l8[vec])
extract(l8,vec)
extract(l8,vec,fun=mean)
plot(extract(l8,vec,fun=mean))
data <- extract(l8,vec,fun=mean)
data
data.T
data@names
names(data)
as.data.frame(data)
data <- as.data.frame(data)
data
names(data)
names(data) <- c(450,512,650,850,1600,2200)
names(data)
plot(data)
data
library(lattice)
plot(data)
x <- names(data)
x
y <- data[1]
y
y <- data[1:-1]
y <- data[1]
y <- data[:]
y <- data[1:6]
y
plot(x,y)
plot(data$names,data)
plot(data$names,data[1:6])
plot(names(data),data[1:6])
data <- extract(l8,vec,fun=mean)
x <- [450,512,650,850,1600,2200]
x <- c(450,512,650,850,1600,2200)
x
plot(x,data)
sd <- extract(l8,vec,fun=sd)
sd
sd <- extract(l8,vec,fun=summary)
sd
sd <- extract(l8,vec,fun=hist)
extract(l8,vec,fun=hist)
warnings()
extract(l8,vec,fun=qqnorm)
extract(l8,vec,fun=box)
extract(l8$l8_oli_20131107.1,vec,fun=box)
extract(l8$l8_oli_20131107.1,vec,fun=boxplot)
extract(l8,vec,fun=boxplot)
box <- extract(l8,vec,fun=boxplot)
box[1]
box[2]
box[3]
box[4]
box[1:6]
show(box[1:6])
plot(box[1:6])
View(box)
View(box)
View(box)
b1 <- extract(l8,vec,fun=boxplot)
b1
show(b1)
vec <- readOGR(dsn="./",layer = "pepe2")
extract(l8,vec,fun=mean)
extract(l8,vec,fun=c("mean","sd"))
extract(l8,vec)
data <- extract(l8,vec)
summary(data)
data1 <- extract(l8,vec)
data1
data <- extract(l8$l8_oli_20131107.4,vec)
data
summary(data)
mean(data)
mean(data1)
data
data[1]
mean(data[1])
pepe <- as.data.frame(data)
pepe
as.matrix(data[1])
as.array(data[1])
mean(as.array(data[1]))
library(reshape)
library(reshape2)
pepe <- melt(data)
pepe
unique(pepe)
unique(pepe$L1)
boxplot(pepe)
boxplot(pepe$value)
boxplot(x = pepe$L1, y=pepe$value)
box(pepe)
plot(pepe)
graphics::boxplot(pepe)
aggregate(pepe)
aggregate(pepe, FUN=mean)
aggregate(pepe, FUN=mean, by= L1)
aggregate(pepe, FUN=mean, by= "L1")
aggregate(pepe$value, FUN=list(pepe$L1), FUN=mean)
aggregate(pepe$value, FUN=list(pepe$L1), FUN=mean)[2]
aggregate(pepe$value, FUN=list(pepe$L1), FUN=mean)[1]
aggregate(pepe$value, FUN=list(pepe$L1), FUN=mean)
aggregate(pepe$value, by=list(pepe$L1), FUN=mean)
aggregate(pepe$value, by=list(pepe$L1), FUN=c(mean,sd))
aggregate(pepe$value, by=list(pepe$L1), FUN= function(x) c(mn = mean(x), sd = sd(x) ) )
(5.4-x)*(6.1-x)-4.5**2=0
(5.4-x)*(6.1-x)-4.5**2
eigen(cbind(c(5.4,4.5), c(4.5,6.1)))
cbind(c(5.4,4.5), c(4.5,6.1))
A<-cbind(c(5.4,4.5), c(4.5,6.1))
eigen(A)
A<-cbind(c(28.0,4.2), c(4.2,16.4))
eigen(A)
10.26+1.24
1.24/11.5
29.36+15.04
15.04/44.4
install.packages("hsdar")
#install.packages("hsdar")
install.packages("hsdar")
library(landsat)
library(raster)
nov3 <- as.data.frame(raster("LT52280791989017CUB00/LT52280791989017CUB00_B3.TIF"))
nov4 <- as.data.frame(raster("LT52280791989017CUB00/LT52280791989017CUB00_B4.TIF"))
BSL(nov3,nov4)
plot(as.vector(as.matrix(nov3)), as.vector(as.matrix(nov4)))
abline(nov.bsl$BSL, col="red")
nov.bsl <- BSL(nov3,nov4)
nov.bsl
abline(nov.bsl$BSL, col="red")
points(nov.bsl$top[1], nov.bsl$top[2], col="green", cex=2, pch=16)
nov3
nov.bsl
1**2+1.05**2
sqrt(2.1025)
1/1.45
1.05/1.45
.6897/.7241
1**2+0.9525**2
1/1.9073
sqrt(1**2+0.9525**2)
1/1.3810
0.9525/1.3810
0.6897**2+0.7241**2
0.7241**2+0.6897**2
0.6897*0.7241*0.7241*0.6897
0.6897*0.7241-0.7241*0.6897
library(raster)
library(landsat)
brick("test/curso2/LT52300771992104CUB00/LT52300771992104CUB00 (copy).vrt")
l5 <- brick("test/curso2/LT52300771992104CUB00/LT52300771992104CUB00 (copy).vrt")
nov.bsl <- BSL(as.matrix(l5$LT52300771992104CUB00_.copy..3),as.matrix(l5$LT52300771992104CUB00_.copy..4) )
nov.bsl
plot(l5$LT52300771992104CUB00_.copy..3, l5$LT52300771992104CUB00_.copy..4)
abline(nov.bsl$BSL, col="red")
points(nov.bsl$top[1], nov.bsl$top[2], col="green", cex=2, pch=16)
demo()
Hershey
Hershey()
plotmath
plotmath()
persp
persp()
error.chatching
setwd("~/Documents/curso-sopi-herramientas-cuantitativas/material")
library(raster)
library(RStoolbox)
library(ggplot2)
meta.2000 <- readMeta("raster_data/LE72240782000188EDC00/LE72240782000188EDC00_MTL.txt")
dn.2000 <- stackMeta(meta.2000)
dn.2000
l5_2011 <- l5_2011[[c(1:5,8]]
# Calibramos a radiancias
# A mano
dn2rad <- meta2011$CALRAD
dn2rad <- dn2rad[-6,]
l5_2011_rad <- l5_2011*dn2rad$gain+dn2rad$offset
## Automatico
l5_2011_rad <- radCor(l5_2011, metaData = meta2011, method="rad")
# Calibramos a reflectancia
l5_2011_toa <- radCor(l5_2011, metaData = meta2011, method="apref")
# Correcciones por DOS
hist(l5_2011)
# Simple
haze <- estimateHaze(l5_2011,darkProp = 0.01, hazeBands = 1:4, plot=TRUE)
l5_2011_sdos <- radCor(l5_2011, metaData = meta2011, hazeValues = haze, hazeBands = c("B1_dn","B2_dn","B3_dn","B4_dn"), method="sdos")
# DOS
l5_2011_dos <- radCor(l5_2011, metaData = meta2011, method="dos")
# COSTZ
l5_2011_costz <- radCor(l5_2011, metaData = meta2011, method="costz")
## Guardar imagenes
# Agregamos el header de ENVI
rasterOptions(addheader = "ENVI")
writeRaster(l5_2011_rad,"raster_data/processed/l5_2011_rad")
writeRaster(l5_2011_toa,"raster_data/processed/l5_2011_toa")
writeRaster(l5_2011_sdos,"raster_data/processed/l5_2011_sdos")
writeRaster(l5_2011_dos,"raster_data/processed/l5_2011_dos")
writeRaster(l5_2011_costz,"raster_data/processed/l5_2011_costz")
ref.2000[[c(1:5,8]]
ref.2000[[c(1:5,8)]]
dn.2000[[c(1:5,8)]]
dn.2000 <- dn.2000[[c(1:5,8]]
# Calibramos a radiancias
# A mano
dn2rad <- meta2011$CALRAD
dn2rad <- dn2rad[-6,]
l5_2011_rad <- l5_2011*dn2rad$gain+dn2rad$offset
## Automatico
l5_2011_rad <- radCor(l5_2011, metaData = meta2011, method="rad")
# Calibramos a reflectancia
l5_2011_toa <- radCor(l5_2011, metaData = meta2011, method="apref")
# Correcciones por DOS
hist(l5_2011)
# Simple
haze <- estimateHaze(l5_2011,darkProp = 0.01, hazeBands = 1:4, plot=TRUE)
l5_2011_sdos <- radCor(l5_2011, metaData = meta2011, hazeValues = haze, hazeBands = c("B1_dn","B2_dn","B3_dn","B4_dn"), method="sdos")
# DOS
l5_2011_dos <- radCor(l5_2011, metaData = meta2011, method="dos")
# COSTZ
l5_2011_costz <- radCor(l5_2011, metaData = meta2011, method="costz")
## Guardar imagenes
# Agregamos el header de ENVI
rasterOptions(addheader = "ENVI")
writeRaster(l5_2011_rad,"raster_data/processed/l5_2011_rad")
writeRaster(l5_2011_toa,"raster_data/processed/l5_2011_toa")
writeRaster(l5_2011_sdos,"raster_data/processed/l5_2011_sdos")
writeRaster(l5_2011_dos,"raster_data/processed/l5_2011_dos")
writeRaster(l5_2011_costz,"raster_data/processed/l5_2011_costz")
dn.2000 <- dn.2000[[c(1:5,8)]]
dn2rad <- meta2011$CALRAD
dn2rad <- dn2rad[c(1:5,8),]
dn2rad <- meta.2000$CALRAD
dn2rad <- dn2rad[c(1:5,8),]
dn2rad
toa.2000 <- dn.2000*dn2rad$gain+dn2rad$offset
rad.2000 <- radCor(dn.2000, metaData = meta.2000, method="rad")
toa.2000 <- radCor(dn.2000, metaData = meta.2000, method="apref")
haze.2000 <- estimateHaze(dn.2000,darkProp = 0.01, hazeBands = 1:4, plot=TRUE)
cost.2000 <- radCor(dn.2000, metaData = meta.2000, method="costz")
hist(cost.2000)
hist(dn.2000)
xml.2016 <- readMeta("raster_data/LC82240782016304/LC82240782016304LGN00.xml")
ref.2016 <- stackMeta(xml.2015, quantity = "sre")
scaleF <- getMeta(ref.2016, xml.2016, what = "SCALE_FACTOR")
xml.2016 <- readMeta("raster_data/LC82240782016304/LC82240782016304LGN00.xml")
ref.2016 <- stackMeta(xml.2016, quantity = "sre")
scaleF <- getMeta(ref.2016, xml.2016, what = "SCALE_FACTOR")
ref.2016 <- ref.2016 * scaleF
ref.2016 <- ref.2016[[-1,]]
names(ref.2015) <- c("blue","green","red","nir","swir1","swir2")
names(ref.2016) <- c("blue","green","red","nir","swir1","swir2")
ref.2016
ndvi.2016 <- (ref.2016$nir-ref.2016$red)/(ref.2016$nir+ref.2016$red)
cols <- colorRampPalette(brewer.pal(9,"YlGn"))(16)
plot(ndvi.2016, col=cols, zlim=c(0,1))
library(raster)
library(RStoolbox)
library(landsat)
library(RColorBrewer)
library(rgdal)
library(ggplot2)
library(GGally)
cols <- colorRampPalette(brewer.pal(9,"YlGn"))(16)
plot(ndvi.2016, col=cols, zlim=c(0,1))
par( mfrow = c( 1, 1 ) )
ndvi_evi.2016 <- spectralIndices(ref.2016, blue="blue",red="red", nir="nir", indices=c("NDVI","EVI"))
par( mfrow = c( 1, 1 ) )
plot(ndvi_evi.2016,col=cols, zlim=c(0,1))
indices.2016 <- spectralIndices(ref.2015, red="red", nir="nir")
plot(indices.2016,col=cols, zlim=c(0,1))
indices.2016 <- spectralIndices(ref.2016, red="red", nir="nir")
plot(indices.2016,col=cols, zlim=c(0,1))
mask.2016 <- raster("raster_data/LC82240782016304/LC82240782016304LGN00_cfmask.tif")
plot(mask.2016)
masked.2016 <- mask(ref.2016, mask=mask.2016, inverse=TRUE, maskvalue=0, updatevalue=255)
masked.2016[masked.2016<=0] <- 255
bsl.2016 <- BSL(as.matrix(masked.2016$red), as.matrix(masked.2016$nir),method="quantile", ulimit=0.99, llimit=0.001)
plot(ref.2016$red, ref.2016$nir)
abline(bsl.2016$BSL, col="red")
# Calculamos el tSAVI a mano
m <- bsl.2016$BSL['Intercept']
b <- bsl.2016$BSL['Slope']
tSAVI.2016 <- m*(ref.2016$nir-m*ref.2016$red-b)/(m*ref.2016$nir+ref.2016$red-m*b)
plot(tSAVI.2016,col=cols, zlim=c(0,1))
m <- bsl.2016$BSL['Intercept']
b <- bsl.2016$BSL['Slope']
tSAVI.2016 <- m*(ref.2016$nir-m*ref.2016$red-b)/(m*ref.2016$nir+ref.2016$red-m*b)
plot(tSAVI.2016,col=cols, zlim=c(0,1))
tSAVI.2016
plot(tSAVI.2016,col=cols)
m
b
ref.2016
tSAVI.2016
plot(tSAVI.2016,col=cols, zlim=c(0,20))
plot(tSAVI.2016,col=cols, zlim=c(0,100))
plot(tSAVI.2016,col=cols, zlim=c(-100,100))
plot(tSAVI.2016,col=cols, zlim=c(-200,100))
m
b
# Calculamos el tSAVI a mano
b <- bsl.2016$BSL['Intercept']
m <- bsl.2016$BSL['Slope']
tSAVI.2016 <- m*(ref.2016$nir-m*ref.2016$red-b)/(m*ref.2016$nir+ref.2016$red-m*b)
plot(tSAVI.2016,col=cols)
plot(tSAVI.2016,col=cols)
pairs(indices.2016)
